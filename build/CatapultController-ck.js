/*
forked and ported from:
http://www.emanueleferonato.com/2010/05/04/following-a-body-with-the-camera-in-box2d-the-smart-way/
*/define(["controllers/physics/actors/ActorsController","easel","box2d","config/config"],function(e){var t=function(t,n,r,i,s,o,u,a,f,l,c,h,p,d){var v=Box2D.Common.Math.b2Vec2,m=Box2D.Dynamics.b2BodyDef,g=Box2D.Dynamics.b2Body,y=Box2D.Dynamics.b2FixtureDef,b=Box2D.Dynamics.b2Fixture,w=Box2D.Dynamics.b2World,E=Box2D.Collision.Shapes.b2PolygonShape,S=Box2D.Collision.Shapes.b2CircleShape,x=Box2D.Dynamics.b2DebugDraw,T=Box2D.Collision.Shapes.b2MassData,N=Box2D.Dynamics.Joints.b2RevoluteJointDef,C=Box2D.Dynamics.Joints.b2RevoluteJoint,k={},L,A,O,M;k.rear_wheel_body;k.front_wheel_body;var _,D,P,H=!1,B=!1,j=!1,F=new e(u,a,s,o),I=function(){var e=d+"imgs/vehicles/catapults/common/cannonball.png",t=53,n=44,r={x:c/o,y:h/o},s="cannonball",u=!1,a=null,f=F.createSkin(e,t,n,r,s,u,a);i.addChild(f);var l=20,p=.9,v=.5,m=20,g=20,y="teamA",b={shape:"circle",type:"dynamic"};L=F.createActor("cannonball",f,l,p,v,b,t,n,m,g,y)},q=function(e,t,n,r,s){var u=d+"imgs/vehicles/catapults/common/wheel.png",a=84,f=84,l=t,c=n,h={x:t/o,y:n/o},p=e,v=!1,m=null,g=F.createSkin(u,a,f,h,p,v,m);i.addChild(g);var y=30,b=.9,w=.1,E=40,S=40,x="teamA",T={shape:"circle",type:"dynamic"};k[s]=F.createActor(e,g,y,b,w,T,a,f,E,S,x)},R=function(e,t){var n=new N;n.enableMotor=!0;n.Initialize(A,k.front_wheel_body,new v(0,0));n.localAnchorA=new v(e/o,0);n.localAnchorB=new v(0,0);D=s.CreateJoint(n);D.SetMaxMotorTorque(1e6);var r=new N;r.enableMotor=!0;r.Initialize(A,k.rear_wheel_body,new v(0,0));r.localAnchorA=new v(t/o,0);r.localAnchorB=new v(0,0);P=new N;P=s.CreateJoint(r);P.SetMaxMotorTorque(1e6)},U=function(){var e=d+"imgs/vehicles/catapults/common/armlauncher.png",t=297,n=75,r=210,s=110,u={x:r/f,y:s/l},a="catapult arm",c=!1,h=null,p=F.createSkin(e,t,n,u,a,c,h);i.addChild(p);var m=5,g=.9,b=.1,w=150,S=10,x="teamA",T=new E;T.SetAsOrientedBox(150/f,10/l,new v(0,0),0);var N=new y;N.shape=T;N.friction=.9;N.density=5;N.restitution=.1;var C=new E;C.SetAsOrientedBox(10/f,20/l,new v(-140/o,-30/o),0);var k=new y;k.shape=C;k.friction=.9;k.density=10;k.restitution=.1;var L=[N,k],A={x:0,y:-0.7},M={shape:"box-orientated",type:"dynamic",vector:new v(0,0),fixtures:L,skinOffset:A},_=!1;O=F.createActor(a,p,m,g,b,M,t,n,w,S,x,_)},z=function(){var e=d+"imgs/vehicles/catapults/common/mastbase.png",t=250,n=121,r=c,s=h,u={x:c,y:h};console.log(r/f);var a="catapult body",p=!1,m=null,g=F.createSkin(e,t,n,u,a,p,m);i.addChild(g);var b=5,w=.9,S=.1,x=150,T=10,N="teamA",C=new E;C.SetAsOrientedBox(125/f,20/l,new v(0,0),0);var k=new y;k.shape=C;k.friction=.9;k.density=50;k.restitution=.1;var L=new E;L.SetAsOrientedBox(20/f,60/l,new v(-80/o,-40/o),0);var O=new y;O.shape=L;O.friction=.9;O.density=1;O.restitution=.1;var M=[k,O],_={x:0,y:-1.5},D={shape:"box-orientated",type:"dynamic",vector:new v(0,0),fixtures:M,skinOffset:_},P=!1;A=F.createActor(a,g,b,w,S,D,t,n,x,T,N,P)},W=function(){var e=new N;e.enableMotor=!0;e.enableLimit=!0;e.Initialize(A,O,new v(0,0));e.localAnchorA=new v(-80/o,-90/o);e.localAnchorB=new v(60/o,0);_=s.CreateJoint(e);_.SetMotorSpeed(1e3);_.SetLimits(-Math.PI,Math.PI/3);_.SetMaxMotorTorque(1)},X=function(e){_.SetMaxMotorTorque(e);j=!1},V=function(){var e;B&&(e=1);H&&(e=-1);if(!B&&!H){e=P.GetMotorSpeed()*.9;Math.abs(e)<.1&&(e=0)}P.SetMotorSpeed(e);D.SetMotorSpeed(e)},$=function(e){if(e==="LEFT"){B=!1;H=!0}else{B=!0;H=!1}},J=function(){var e,t,r=0,i=0,s=n.width,u=n.height,a=2800,f=800,l=a-700,c=0,h=f/2,p=0;V();if(j){e=A.GetWorldCenter().x*o;t=A.GetWorldCenter().y*o}else{e=L.GetWorldCenter().x*o;t=L.GetWorldCenter().y*o}e=s/2-e;e<-l&&(e=-l);e>c&&(e=c);r=e;t=u/2-t;t<p&&(t=p);t>h&&(t=h);i=t;return{x:r,y:i}},K=function(){z();U();W();var e=470,t=220,n=d+"imgs/vehicles/catapults/common/wheel.png";q("front wheel",e,200,n,"front_wheel_body");q("rear wheel",t,200,n,"rear_wheel_body");var r=100,i=-100;R(r,i);I()},Q=function(){K()},G="right",Y=function(e){G=e},Z=function(){return G};return{spawn:Q,setMaxMotorTorque:X,setKeyPressed:$,setMotorSpeed:V,getCameraFocus:J,setDirection:Y}};return t});