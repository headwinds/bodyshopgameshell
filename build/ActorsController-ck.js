define(["easel","box2d"],function(){var e=function(e,t,n,r){var i=Box2D.Common.Math.b2Vec2,s=Box2D.Dynamics.b2BodyDef,o=Box2D.Dynamics.b2Body,u=Box2D.Dynamics.b2FixtureDef,a=Box2D.Dynamics.b2Fixture,f=Box2D.Dynamics.b2World,l=Box2D.Collision.Shapes.b2PolygonShape,c=Box2D.Collision.Shapes.b2CircleShape,h=Box2D.Dynamics.b2DebugDraw,p=Box2D.Collision.Shapes.b2MassData,d=Box2D.Dynamics.Joints.b2RevoluteJointDef,v=Box2D.Dynamics.Joints.b2RevoluteJoint,m=function(e,t,n,r,i,s,o){var u;if(s){var a={images:[e],frames:{width:t,height:n},animations:o.animations},f=new createjs.SpriteSheet(a);f.complete||(f.onComplete=g);var l=new createjs.BitmapAnimation(f);l.regX=t/2;l.regY=n/2;var c=o.labels[0];l.stop();l.name=i;l.speed=1;l.direction=90;l.vX=3;l.vY=0;l.x=r.x;l.y=r.y;l.snapToPixel=!0;l.mouseEnabled=!1;l.currentFrame=0;u=l}else{var h=new createjs.Bitmap(e);h.x=r.x;h.y=r.y;h.width=t;h.height=n;h.regX=t/2;h.regY=n/2;h.snapToPixel=!0;h.mouseEnabled=!1;h.name=i;u=h}return u},g=function(e){console.log("ActorsController / onSpriteSheetLoadedHandler")},y=function(t,n,i){this.body=t;this.skin=n;this.update=function(){if(i===undefined){this.skin.x=this.body.GetWorldCenter().x*r;this.skin.y=this.body.GetWorldCenter().y*r;this.skin.rotation=this.body.GetAngle()*(180/Math.PI)}else{this.skin.x=(this.body.GetWorldCenter().x+i.x)*r;this.skin.y=(this.body.GetWorldCenter().y+i.y)*r;this.skin.rotation=this.body.GetAngle()*(180/Math.PI)}};e.push(this)},b=function(e){var t=4,n=-1,r=1,i=2,s=1,o=-1,u=1,a=2,f=-2,l={teamA:{categoryBits:i,maskBits:s,groupIndex:o},teamB:{categoryBits:u,maskBits:a,groupIndex:f},teamEnvironment:{categoryBits:t,maskBits:n,groupIndex:r}};return l[e]},w=function(e){switch(e){case"static":return o.b2_staticBody;case"dynamic":return o.b2_dynamicBody;default:return o.b2_dynamicBody}},E=function(e,i,o,a,f,h,p,d,v,m,g,E){var S=h.shape,x=w(h.type),T=new s;T.type=x;T.position.x=i.x/r+5;T.position.y=i.y/r;T.allowSleep=E;e=="catapult body"&&console.log(T.position.x);var N=n.CreateBody(T);if(h.fixtures===undefined){var C=new u;C.density=o;C.friction=a;C.restitution=f;var k=b(g);C.filter.groupIndex=k.groupIndex;switch(S){case"circle":C.shape=new c(v/2/r);C.type=x;break;case"box":C.shape=new l;C.type=x;var L=v/2/r,A=m/2/r;C.shape.SetAsBox(L,A);break;case"box-orientated":C.shape=new l;C.type=x;var L=v/2/r,A=m/2/r;C.shape.SetAsOrientedBox(L,A,h.vector,0)}N.CreateFixture(C)}else{var O=h.fixtures.length;for(var M=0;M<O;M++)N.CreateFixture(h.fixtures[M])}var _;h.skinOffset===undefined?_=new y(N,i):_=new y(N,i,h.skinOffset);N.SetUserData(_);t.push(N);return N},S=function(e,t){switch(e){case"revolute":x(t);break;case"distance":T(t);break;default:T(t)}},x=function(e){var t=new d;t.collideConnected=!1;var r=N(e[0]),i=N(e[1]);t.Initialize(r,i,i.GetPosition());t.maxMotorTorque=10;t.enableMotor=!1;n.CreateJoint(t)},T=function(e){var t=new b2DistanceJointDef;t.bodyA=bodyA;t.bodyB=bodyB;t.dampingRatio=.7;t.frequencyHz=.2;t.collideConnected=!0;t.localAnchorA=new i(bodyA.GetPosition().x,bodyA.GetPosition().y);t.localAnchorB=new i(bodyB.GetPosition().x,bodyB.GetPosition().y);n.CreateJoint(t)},N=function(e){var t;for(t=n.GetBodyList();t;t=t.GetNext())if(t.GetUserData()!=null){var r=t.GetUserData().skin.name;if(r==e)return t}};return{createSkin:m,createActor:E,createJoint:S}};return e});